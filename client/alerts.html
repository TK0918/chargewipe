<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerts - Chargeback Alert System</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        .breadcrumb {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }
        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .info-item {
            padding: 15px;
            background: #fafafa;
            border-radius: 2px;
        }
        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Chargeback Alert System</div>
        <nav>
            <ul class="nav-menu">
                <li><a href="authorizations.html">Authorizations</a></li>
                <li><a href="alerts.html" class="active">Alerts</a></li>
                <li><a href="wallet.html">Wallet</a></li>
            </ul>
        </nav>
        <div class="user-info">
            <span>Customer A</span>
            <a href="login.html" class="action-link">Logout</a>
        </div>
    </div>
    <div class="main-content">
        <!-- 预警列表页 -->
        <div id="list-page" class="page-section active">
            <div class="page-header">
                <h1 class="page-title">Alerts</h1>
            </div>

            <!-- 搜索栏 -->
            <div class="search-bar">
                <form class="search-form" onsubmit="return false;">
                    <div class="search-item">
                        <label class="form-label">Alert Type</label>
                        <select class="form-select" id="searchType">
                            <option value="">All</option>
                            <option value="ETHOCA">ETHOCA</option>
                            <option value="RDR">RDR</option>
                        </select>
                    </div>
                    <div class="search-item">
                        <label class="form-label">Descriptor</label>
                        <input type="text" class="form-input" placeholder="Enter Descriptor" id="searchDescriptor">
                    </div>
                    <div class="search-item">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="searchStatus">
                            <option value="">All</option>
                            <option value="pending">Pending Feedback</option>
                            <option value="completed">Completed</option>
                            <option value="none">No Action Needed</option>
                        </select>
                    </div>
                    <div class="search-item">
                        <label class="form-label">Received Time</label>
                        <input type="date" class="form-input" id="searchDate">
                    </div>
                    <div class="search-item">
                        <button type="button" class="btn btn-primary" onclick="searchAlerts()">Search</button>
                        <button type="reset" class="btn btn-default" style="margin-left: 8px;">Reset</button>
                    </div>
                </form>
            </div>

            <!-- 预警列表 -->
            <div class="card">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Alert ID</th>
                            <th>Alert Type</th>
                            <th>Descriptor</th>
                            <th>Transaction Amount</th>
                            <th>Transaction Time</th>
                            <th>Card Last 4</th>
                            <th>Status</th>
                            <th>Received Time</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="alertTableBody">
                        <tr>
                            <td>ALT001</td>
                            <td><span class="tag tag-info">ETHOCA</span></td>
                            <td>MYSHOP*STORE</td>
                            <td>$125.50</td>
                            <td>2025-01-14 10:30:00</td>
                            <td>1234</td>
                            <td><span class="tag tag-warning">Pending Feedback</span></td>
                            <td>2025-01-15 10:30:00</td>
                            <td>
                                <div class="action-buttons">
                                    <a href="javascript:void(0)" onclick="showDetail('ALT001')" class="action-link">View</a>
                                    <a href="javascript:void(0)" onclick="showFeedback('ALT001')" class="action-link">Submit Feedback</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>ALT002</td>
                            <td><span class="tag tag-info">RDR</span></td>
                            <td>STORE*SHOP</td>
                            <td>$89.99</td>
                            <td>2025-01-14 11:15:00</td>
                            <td>5678</td>
                            <td><span class="tag tag-info">No Action Needed</span></td>
                            <td>2025-01-15 11:15:00</td>
                            <td>
                                <div class="action-buttons">
                                    <a href="javascript:void(0)" onclick="showDetail('ALT002')" class="action-link">View</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>ALT003</td>
                            <td><span class="tag tag-info">ETHOCA</span></td>
                            <td>MYSHOP*STORE</td>
                            <td>$156.00</td>
                            <td>2025-01-13 15:20:00</td>
                            <td>9012</td>
                            <td><span class="tag tag-success">Completed</span></td>
                            <td>2025-01-14 09:00:00</td>
                            <td>
                                <div class="action-buttons">
                                    <a href="javascript:void(0)" onclick="showDetail('ALT003')" class="action-link">View</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <button>Previous</button>
                    <button class="active">1</button>
                    <button>2</button>
                    <button>Next</button>
                </div>
            </div>
        </div>

        <!-- 预警详情页 -->
        <div id="detail-page" class="page-section">
            <div class="breadcrumb">
                <a onclick="showPage('list-page')">Alerts</a> > Alert Details
            </div>
            <div class="page-header">
                <h1 class="page-title">Alert Details</h1>
                <div class="action-buttons" id="detailActions">
                    <button class="btn btn-primary" onclick="showFeedback(currentAlertId)" id="feedbackBtn" style="display: none;">Submit Feedback</button>
                </div>
            </div>

            <!-- 预警基本信息 -->
            <div class="card">
                <div class="card-header">Alert Information</div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Alert ID</div>
                        <div class="info-value" id="detailAlertId">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Alert Type</div>
                        <div class="info-value" id="detailAlertType">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Descriptor</div>
                        <div class="info-value" id="detailDescriptor">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Transaction Amount</div>
                        <div class="info-value" id="detailTransactionAmount">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Transaction Time</div>
                        <div class="info-value" id="detailTransactionTime">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Card Last 4</div>
                        <div class="info-value" id="detailCardLast4">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value" id="detailStatus">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Received Time</div>
                        <div class="info-value" id="detailReceivedTime">-</div>
                    </div>
                </div>
            </div>

            <!-- 扣费信息 -->
            <div class="card">
                <div class="card-header">Charge Information</div>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Charge Status</div>
                        <div class="info-value" id="detailChargeStatus">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Charge Amount</div>
                        <div class="info-value" id="detailChargeAmount">-</div>
                    </div>
                </div>
            </div>

            <!-- ETHOCA反馈信息（仅已反馈的ETHOCA显示） -->
            <div class="card" id="feedbackInfoCard" style="display: none;">
                <div class="card-header">Feedback Information</div>
                <table class="table" style="max-width: 600px;">
                    <tr>
                        <td style="width: 200px; font-weight: 600;">Refund ID</td>
                        <td id="detailRefundId">-</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">Refund Amount</td>
                        <td id="detailRefundAmount">-</td>
                    </tr>
                    <tr>
                        <td style="font-weight: 600;">Refund Time</td>
                        <td id="detailRefundTime">-</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- ETHOCA反馈页 -->
        <div id="feedback-page" class="page-section">
            <div class="breadcrumb">
                <a onclick="showPage('list-page')">Alerts</a> > Submit Feedback
            </div>
            <div class="page-header">
                <h1 class="page-title">Submit ETHOCA Feedback</h1>
            </div>

            <div class="card">
                <div class="form-group">
                    <label class="form-label">Alert ID</label>
                    <input type="text" class="form-input" id="feedbackAlertId" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">Transaction Amount</label>
                    <input type="text" class="form-input" id="feedbackTransactionAmount" readonly>
                </div>
                <form id="feedbackForm">
                    <div class="form-group">
                        <label class="form-label">Refund ID <span class="required">*</span></label>
                        <input type="text" class="form-input" name="refund_id" placeholder="Enter refund transaction ID" required>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            The refund transaction ID from your payment processor
                        </p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Refund Amount <span class="required">*</span></label>
                        <input type="number" class="form-input" name="refund_amount" placeholder="0.00" step="0.01" min="0.01" required>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            Must be greater than 0, up to 2 decimal places
                        </p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Refund Time <span class="required">*</span></label>
                        <input type="datetime-local" class="form-input" name="refund_time" required>
                        <p style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                            When the refund was processed (cannot be a future time)
                        </p>
                    </div>
                    <div class="form-group">
                        <p style="font-size: 12px; color: var(--text-secondary);">
                            <strong>Note:</strong> You can only submit feedback once. After submission, it cannot be modified or revoked.
                        </p>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Submit Feedback</button>
                        <button type="button" class="btn btn-default" style="margin-left: 8px;" onclick="showDetail(currentAlertId)">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let currentAlertId = '';

        // 页面切换函数
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // 显示预警详情
        function showDetail(alertId) {
            currentAlertId = alertId;
            // 模拟数据
            document.getElementById('detailAlertId').textContent = alertId;
            document.getElementById('detailAlertType').innerHTML = '<span class="tag tag-info">ETHOCA</span>';
            document.getElementById('detailDescriptor').textContent = 'MYSHOP*STORE';
            document.getElementById('detailTransactionAmount').textContent = '$125.50';
            document.getElementById('detailTransactionTime').textContent = '2025-01-14 10:30:00';
            document.getElementById('detailCardLast4').textContent = '1234';
            document.getElementById('detailStatus').innerHTML = '<span class="tag tag-warning">Pending Feedback</span>';
            document.getElementById('detailReceivedTime').textContent = '2025-01-15 10:30:00';
            document.getElementById('detailChargeStatus').innerHTML = '<span class="tag tag-success">Charged</span>';
            document.getElementById('detailChargeAmount').textContent = '$10.00';

            // 显示/隐藏反馈按钮
            const feedbackBtn = document.getElementById('feedbackBtn');
            const feedbackCard = document.getElementById('feedbackInfoCard');
            
            if (alertId === 'ALT001') {
                // Pending Feedback状态，显示提交反馈按钮
                feedbackBtn.style.display = 'inline-block';
                feedbackCard.style.display = 'none';
            } else if (alertId === 'ALT003') {
                // Completed状态，显示反馈信息
                feedbackBtn.style.display = 'none';
                feedbackCard.style.display = 'block';
                document.getElementById('detailRefundId').textContent = 'REF001';
                document.getElementById('detailRefundAmount').textContent = '$156.00';
                document.getElementById('detailRefundTime').textContent = '2025-01-15 14:00:00';
            } else {
                // RDR类型，无需操作
                feedbackBtn.style.display = 'none';
                feedbackCard.style.display = 'none';
            }

            showPage('detail-page');
        }

        // 显示反馈页面
        function showFeedback(alertId) {
            currentAlertId = alertId;
            document.getElementById('feedbackAlertId').value = alertId;
            document.getElementById('feedbackTransactionAmount').value = '$125.50';
            document.querySelector('input[name="refund_id"]').value = '';
            document.querySelector('input[name="refund_amount"]').value = '';
            document.querySelector('input[name="refund_time"]').value = '';
            
            showPage('feedback-page');
        }

        // 搜索预警
        function searchAlerts() {
            alert('Search functionality requires backend API');
        }

        // 表单提交
        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const refundId = this.querySelector('input[name="refund_id"]').value;
            const refundAmount = parseFloat(this.querySelector('input[name="refund_amount"]').value);
            const refundTime = new Date(this.querySelector('input[name="refund_time"]').value);
            const now = new Date();

            if (!refundId) {
                alert('Refund ID cannot be empty');
                return;
            }

            if (!refundAmount || refundAmount <= 0) {
                alert('Refund amount must be greater than 0');
                return;
            }

            if (refundTime > now) {
                alert('Refund time cannot be in the future');
                return;
            }

            alert('Feedback submitted successfully (requires backend API). Status will be updated to Completed.');
            showDetail(currentAlertId);
        });
    </script>
</body>
</html>
